---
title: "3_analysis"
output: html_document
date: "2024-04-22"
---

```{r}
library(tidyverse)
library(lme4)
library(lmerTest)
```

```{r}
master <- read.csv(file='../data/master.csv')
matched <- read.csv(file='../data/anhedonics_matchedcontrols.csv')
```

#subsetting
```{r}
liking_master <- master %>%
  subset(rating=="liking")

liking_matched_pre <- matched %>%
  subset(rating=="liking") %>%
  subset(pre_post=="pre")

liking_matched_pre$pre <- liking_matched_pre$value

liking_matched_post <- matched 

liking_matched_post$post <- liking_matched_post$value

liking_matched_post <- 
  liking_matched_post %>%
  subset(rating=="liking") %>%
  subset(pre_post=="post") %>%
  select(ResponseId, stim, post)

liking_matchedprepost <- merge(liking_matched_pre, liking_matched_post, by=c("ResponseId", "stim"))

liking_matchedprepost$change <- liking_matchedprepost$post - liking_matchedprepost$pre

speech_master <- master %>%
  subset(rating=="speech")

speech_matched <- matched %>%
  subset(rating=="speech")

speech_matched_pre <- matched %>%
  subset(rating=="speech") %>%
  subset(pre_post=="pre")

speech_matched_pre$pre <- speech_matched_pre$value

speech_matched_post <- matched 

speech_matched_post$post <- speech_matched_post$value

speech_matched_post <- 
  speech_matched_post %>%
  subset(rating=="speech") %>%
  subset(pre_post=="post") %>%
  select(ResponseId, stim, post)

speech_matchedprepost <- merge(speech_matched_pre, speech_matched_post, by=c("ResponseId", "stim"))
speech_matchedprepost$change <- speech_matchedprepost$post - speech_matchedprepost$pre
```

#prelim analyses
```{r}
#did the s2s illusion work in entire sample?
speech_master$stim_type <- as.factor(speech_master$stim_type)
speech_master$pre_post <- as.factor(speech_master$pre_post)
contrasts(speech_master$stim_type) <- c(-0.5,0.5)
speech_master$pre_post <- factor(speech_master$pre_post, levels = c("pre", "post"))
contrasts(speech_master$pre_post) <- c(-0.5,0.5)

m1 <- lmer(data=speech_master, scale(value) ~ stim_type*pre_post + (stim_type*pre_post|ResponseId) + (1|stim), control=lmerControl(optimizer="bobyqa"))
summary(m1)

ggplot(data=speech_master, aes(x=pre_post, y=value, color=stim_type)) + 
 # ggdist::geom_dotsinterval() +
  stat_summary(fun.data = 'mean_cl_normal', geom = 'errorbar', width = 0, alpha=0.5) +
  stat_summary(fun.data = 'mean_cl_normal', geom = 'pointrange', alpha=0.5) +
  theme_classic()+ 
 # theme(legend.position = "none")+
  ylab("Speech Rating") +
  xlab("Pre vs. Post Repetition")

#did liking change as well?
liking_master$stim_type <- as.factor(liking_master$stim_type)
liking_master$stim <- as.factor(liking_master$stim)
liking_master$pre_post <- as.factor(liking_master$pre_post)
liking_master$pre_post <- factor(liking_master$pre_post, levels = c("pre", "post"))
contrasts(liking_master$stim_type) <- c(-0.5,0.5)
contrasts(liking_master$pre_post) <- c(-0.5,0.5)

m2 <- lmer(data=liking_master, scale(value) ~ stim_type*pre_post + (stim_type*pre_post|ResponseId) + (1|stim),control=lmerControl(optimizer="bobyqa"))
summary(m2)

ggplot(data=liking_master, aes(x=pre_post, y=value, color=stim_type)) + 
 # ggdist::geom_dotsinterval() +
  stat_summary(fun.data = 'mean_cl_normal', geom = 'errorbar', width = 0, alpha=0.5) +
  stat_summary(fun.data = 'mean_cl_normal', geom = 'pointrange', alpha=0.5) +
  theme_classic()+ 
 theme(legend.position = "none")+
  ylab("Liking Rating") +
  xlab("Pre vs. Post Repetition")
```

```{r}
#how about for anhedonics? --> creating a delta rating to avoid 3-way interaction
#speech
speech_matchedprepost$stim_type <- as.factor(speech_matchedprepost$stim_type)
speech_matchedprepost$group <- as.factor(speech_matchedprepost$group)
contrasts(speech_matchedprepost$stim_type) <- c(-0.5,0.5)
contrasts(speech_matchedprepost$group) <- c(0.5,-0.5)

m1 <- lmer(data=speech_matchedprepost, scale(change) ~ stim_type*group + (stim_type + group|ResponseId) + (1|stim),control=lmerControl(optimizer="bobyqa"))
summary(m1)

ggplot(data=speech_matchedprepost, aes(x=stim_type, y=value, color=group)) + 
 # ggdist::geom_dotsinterval() +
  stat_summary(fun.data = 'mean_cl_normal', geom = 'errorbar', width = 0, alpha=0.5) +
  stat_summary(fun.data = 'mean_cl_normal', geom = 'pointrange', alpha=0.5) +
  theme_classic()+ 
 # theme(legend.position = "none")+
  ylab("Change in Speech Rating after Repetition") +
  xlab("Stimulus Type")

#liking
liking_matchedprepost$stim_type <- as.factor(liking_matchedprepost$stim_type)
liking_matchedprepost$group <- as.factor(liking_matchedprepost$group)
contrasts(liking_matchedprepost$stim_type) <- c(-0.5,0.5)
contrasts(liking_matchedprepost$group) <- c(0.5,-0.5)

m1 <- lmer(data=liking_matchedprepost, scale(change) ~ stim_type*group + (stim_type + group|ResponseId) + (1|stim))
summary(m1)

ggplot(data=liking_matchedprepost, aes(x=stim_type, y=value, color=group)) + 
 # ggdist::geom_dotsinterval() +
  stat_summary(fun.data = 'mean_cl_normal', geom = 'errorbar', width = 0, alpha=0.5) +
  stat_summary(fun.data = 'mean_cl_normal', geom = 'pointrange', alpha=0.5) +
  theme_classic()+ 
 # theme(legend.position = "none")+
  ylab("Change in Liking Rating after Repetition") +
  xlab("Stimulus Type")

cor.test(liking_matchedprepost$change, speech_matchedprepost$change)
```